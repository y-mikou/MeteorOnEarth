# MeteorOnEarth

## これはなに？
圏点指定を、「・」ルビに変換するシェルスクリプト。

## 概要
- 対象のファイル1つを引数に取る。
- 一般的な傍点(圏点)指定マークアップである`《《基底文字》》`を変換対象部分とする。
- 一般的なルビ指定マークアップである`｜基底文字《ルビ文字》`の*連続*を変換先とする
- `《《基底文字》》`→`｜基底文字の内1文字《・》`×基底文字すべてが指定されるだけに置換する(モノルビにする)  

ための置換スクリプトです。

## 何に使うの？
Pixiv小説などのいくつかの文章掲載サイトでは、  
`｜《》`をルビ表示に変換する機能はあっても、  
`《《》》`を圏点(傍点)として変換する機能がない。  
圏点指定をルビ指定に変換することで、そうしたサイトに圏点(傍点)を表示できるようにする。

## ただの正規表現置換で良いのでは？

> 《《基底文字》》  

を  

> ｜基底文字《・・・・》  

に変換することは正規表現で容易に達成できるが、  
これをモノルビ指定つまり  

> ｜基《・》｜底《・》｜文《・》｜字《・》  

へ変換することは難しい(どんな文字数にも対応するにはロジックに頼る必要がある)。  
これに対応するためのもの。

## モノルビに意味が？

サイトで適用されているスタイルによっては、基底文字に対する「・」連続によるルビ文字指定は、基底文字1文字に正しい位置に付かないことがある。  
モノルビ指定にすると、それをほぼ回避できる。

## 名前？
ぼくはリグルくんが好きです。


## 処理概要
1. 一旦ベタルビにする
   1. 入力ファイルの傍点部分を`置換元文字列群`として中間ファイルに出力
      ```
      《《基底文字1》》
      《《基底》》
      《《文字3》》
      ```
      といったファイルになる

   2. `置換元文字列群`から傍点マークアップを除去したものを`基底文字列群`として中間ファイルに出力
      ```
      基底文字1
      基底
      文字3
      ```
      といったファイルになる

   3. `基底文字列群`に含まれる文字を全て「・」に置換したものを`ルビ文字列群`として中間ファイルに出力する
      ```
      ・・・・・
      ・・
      ・・・
      ```
      といったファイルになる

   4. `基底文字列群`に含まれる各行を「| sed -e 's/」に置換したものを`部分ファイルHEAD`として中間ファイルに出力する
      ```
      | sed -e 's/
      | sed -e 's/
      | sed -e 's/
      ```
      といったファイルになる
   5. `基底文字列群`に含まれる各行を「/」に置換したものを`部分ファイルMID`として中間ファイルに出力する
      ```
      /
      /
      /
      ```
      といったファイルになる
   6. `基底文字列群`に含まれる各行を「/」に置換したものを`部分ファイルTAIL`として中間ファイルに出力する
      ```
      /g' \
      /g' \
      /g' \
      ```
      といったファイルになる
   7. `基底文字列群`の各行の先頭に「｜」、末尾に「《」を付与する
      ```
      ｜基底文字1《
      ｜基底《
      ｜文字3《
      ```
      といったファイルになる

   8. 7で加工した`基底文字列群`に対して、`ルビ文字列群`を行方向で結合し(Pasteコマンド)、`置換先文字列群`として中間ファイルに出力する
      ```
      ｜基底文字1《・・・・・
      ｜基底《・・
      ｜文字3《・・・
      ```
      といったファイルになる

   9.  `置換先文字列群`の各業の末尾に「》」を付与する
       ```
       ｜基底文字1《・・・・・》
       ｜基底《・・》
       ｜文字3《・・・》
       ```

       といったファイルになる

   10. `置換元文字列群`から`置換先文字列群`へ連続的な置換行うよう  
       `部分ファイルHEAD`,`置換元文字列群`,`部分ファイルMID`,`置換先文字列群`,`部分ファイルTAIL`を列方向に結合した文字列を作り(`paste`コマンド)、`中間シェル.sh`としてを出力する
       ```
       | sed -e 's/《《基底文字1》》/｜基底文字1《・・・・・》/g' \
       | sed -e 's/《《基底》》/｜基底《・・》/g' \
       | sed -e 's/《《文字3》》/｜文字3《・・・》/g' \
       ```
       といったファイルになる

   11. `中間シェル.sh`のファイル先頭に「cat [入力ファイル] \」、ファイル末尾に「> [ルビ化済中間ファイル]」を付与する。
       ```
       cat 入力ファイル \
       | sed -e 's/《《基底文字1》》/｜基底文字1《・・・・・》/g' \
       | sed -e 's/《《基底》》/｜基底《・・》/g' \
       | sed -e 's/《《文字3》》/｜文字3《・・・》/g' \
       > [ルビ化済中間ファイル]
       ```
       といったファイルになる。

   12. 11で作成した`中間シェル.sh`を実行する。これにより`ルビ霞中間ファイル`が出力される
        ```
       ｜基底文字1《・・・・・》
       ｜基底《・・》
       ｜文字3《・・・》
        ```
        といった状態になっているはず

2. モノルビ化する
※一旦モノルビ化なしの状態でver1にする
